<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
<title>Home</title>
<!-- for-mobile-apps -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);
		function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- //for-mobile-apps -->
<link href="/static/css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="/static/css/style.css" rel="stylesheet" type="text/css" media="all" />
<!-- font-awesome icons -->
<link href="/static/css/font-awesome.css" rel="stylesheet" type="text/css" media="all" />
<!-- //font-awesome icons -->
<!-- js -->
<script src="/static/js/jquery-1.11.1.min.js"></script>
<!-- //js -->
<!-- start-smoth-scrolling -->
<script type="text/javascript" src="/static/js/move-top.js"></script>
<script type="text/javascript" src="/static/js/easing.js"></script>
<script type="text/javascript">
	jQuery(document).ready(function($) {
		$(".scroll").click(function(event){		
			event.preventDefault();
			$('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
		});
	});
</script>
<script type="text/javascript">
    $(function(){
         initCart();
         initHotel();
 }
);
function initHotel(){
		$.ajax({
           url:'ajaxHotelList',
           type:'post',
           dataType:'json',          
           success:function(data){
           	  sc='<table><tr><th>房间名称</th><th>图片</th><th style="text-align:center;">数量</th><th style="width:50px;">价格</th></tr>';
           	 $.each(data.data,function(key,val){
			           	 	//alert(JSON.stringify(data.Num[key]));
                     if (data.Num[key]>0) {
                       sc+='<tr><td><input type="hidden" value="'+val.pid+'"><label for="txt_statu" style="width:200px;">'+val.pname+'门票</label></td><td><img height="50px" weight="50px" title=" " alt=" " src="__STATIC__/images/'+val.pimg+'" /></td><td><label id="shuliang" style="width:200px;text-align:center;" for="txt_statu"><button onclick="gbjg1($(this))" value="-1">-</button><label id="suhliangzhen">'+data.Num[key]+'</label><button onclick="gbjg1($(this))" value="1">+</button></label></td><td><label id="jiage">'+(val.pprice*val.pdiscount*data.Num[key]).toFixed(2)+'</label></div></td></tr>';}
                     
                  });
           	 sc+="</table>";
           	$('#cartbody1').html(sc);

		}
	
   		});
 }
 function initCart(){
		$.ajax({
           url:'ajaxCartList',
           type:'post',
           dataType:'json',          
           success:function(data){
           	//
           //	alert(JSON.stringify(data));
           	  sc='<table><tr><th>商品名称</th><th>图片</th><th style="text-align:center;">数量</th><th style="width:50px;">价格</th><th  >是否学生</th></tr>';
           	 
           	 $.each(data.data,function(key,val){
			           	 	//alert(JSON.stringify(data.Num[key]));
                     if (data.Num[key]>0) {
                       sc+='<tr><td><input type="hidden" value="'+val.sid+'"><label for="txt_statu" style="width:200px;">'+val.sname+'门票</label></td><td><img height="50px" weight="50px" title=" " alt=" " src="__STATIC__/images/'+val.simg+'" /></td><td><label id="shuliang" style="width:200px;text-align:center;" for="txt_statu"><button onclick="gbjg($(this))" value="-1">-</button><label id="suhliangzhen">'+data.Num[key]+'</label><button onclick="gbjg($(this))" value="1">+</button></label></td><td><label id="jiage">'+val.sprice*data.Num[key]+'</label></div></td><td><label><input onclick="alerttr($(this))" name="isStudent'+key+'" type="radio" value="1" />学生 </label><label style="text-align:center;"><input onclick="alerttr($(this))" name="isStudent'+key+'" type="radio"  checked value="2" />成人</label></td></tr>';}
                     
                  });
           	 sc+='</table>';
           	$('#cartbody').html(sc);
		}
   		});
 }
     function shoppingcart() {
            //$("#myModalLabel").text("新增");
            $('#shopping').modal();
        }
        function ajaxCart(sid,state){
		$.ajax({
           url:'ajaxPutCart',
           type:'post',
           dataType:'json',  
           data:{'sid':sid,'state':state},    
           success:function(data){
           	//
           //	alert(JSON.stringify(data));''
           	  sc='<table><tr><th>商品名称</th><th>图片</th><th style="text-align:center;">数量</th><th style="width:50px;">价格</th><th  >是否学生</th></tr>';
           	 $.each(data.data,function(key,val){
			           	 	//alert(JSON.stringify(data.Num[key]));
                     if (data.Num[key]>0) {
                       sc+='<tr><td><input type="hidden" value="'+val.sid+'"><label for="txt_statu" style="width:200px;">'+val.sname+'门票</label></td><td><img height="50px" weight="50px" title=" " alt=" " src="__STATIC__/images/'+val.simg+'" /></td><td><label id="shuliang" style="width:200px;text-align:center;" for="txt_statu"><button onclick="gbjg($(this))" value="-1">-</button><label id="suhliangzhen">'+data.Num[key]+'</label><button onclick="gbjg($(this))" value="1">+</button></label></td><td><label id="jiage">'+val.sprice*data.Num[key]+'</label></div></td><td><label><input onclick="alerttr($(this))" name="isStudent'+key+'" type="radio" value="1" />学生 </label><label style="text-align:center;"><input onclick="alerttr($(this))" name="isStudent'+key+'" type="radio"  checked value="2" />成人</label></td></tr>';}
                  });
           	 sc+='</table>';
           	$('#cartbody').html(sc);

		},error:function(){
			//alert(JSON.stringify(sid));
			ajaxCart(sid,0);
		}
   		});
    }
    function gbjg($button){
		$tr=$button.parent().parent().parent();
		$sid=$tr.find("td input[type='hidden']").val();
		$psb=$button.val();
		$.ajax({
           url:'ajaxPlusSub',
           type:'post',
           dataType:'json',  
           data:{'sid':$sid,'psb':$psb},    
           success:function(data){
            sc='<table><tr><th>商品名称</th><th>图片</th><th style="text-align:center;">数量</th><th style="width:50px;">价格</th><th  >是否学生</th></tr>';
           	 $.each(data.data,function(key,val){
			      	if (data.Num[key]>0) {
                       sc+='<tr><td><input type="hidden" value="'+val.sid+'"><label for="txt_statu" style="width:200px;">'+val.sname+'门票</label></td><td><img height="50px" weight="50px" title=" " alt=" " src="__STATIC__/images/'+val.simg+'" /></td><td><label id="shuliang" style="width:200px;text-align:center;" for="txt_statu"><button onclick="gbjg($(this))" value="-1">-</button><label id="suhliangzhen">'+data.Num[key]+'</label><button onclick="gbjg($(this))" value="1">+</button></label></td><td><label id="jiage">'+val.sprice*data.Num[key]+'</label></div></td><td><label><input onclick="alerttr($(this))" name="isStudent'+key+'" type="radio" value="1" />学生 </label><label style="text-align:center;"><input onclick="alerttr($(this))" name="isStudent'+key+'" type="radio"  checked value="2" />成人</label></td></tr>';}
                     
                  });
           	 sc+='</table>';
           	$('#cartbody').html(sc);
      		 }
           	});
    }
        function alerttr($radio){
    	$tr=$radio.parent().parent().parent();
    	$sid=$tr.find("td input[type='hidden']").val();
    	//alert($tr.find("#shuliang").val());
    	$.ajax({
           url:'ajaxStudent',
           type:'post',
           dataType:'json',  
           data:{'sid':$sid},    
           success:function(data){
           	if ($radio.val()==1) {
           		if(data.sstudent<0){
           	$tr.find("#jiage").html($tr.find("#suhliangzhen").html()*0);}else
			$tr.find("#jiage").html($tr.find("#suhliangzhen").html()*data.sstudent)
       }
           else{
			$tr.find("#jiage").html($tr.find("#suhliangzhen").html()*data.sprice);
           }
       }
           	});

    }
   function ajaxCartHotel(pid,state){
	$.ajax({
           url:'ajaxPutHotel',
           type:'post',
           dataType:'json',  
           data:{'pid':pid,'state':state},    
           success:function(data){
           	   sc='<table><tr><th>房间名称</th><th>图片</th><th style="text-align:center;">数量</th><th style="width:50px;">价格</th></tr>';
           	 $.each(data.data,function(key,val){
			           	 	//alert(JSON.stringify(data.Num[key]));
                     if (data.Num[key]>0) {
                       sc+='<tr><td><input type="hidden" value="'+val.pid+'"><label for="txt_statu" style="width:200px;">'+val.pname+'门票</label></td><td><img height="50px" weight="50px" title=" " alt=" " src="__STATIC__/images/'+val.pimg+'" /></td><td><label id="shuliang" style="width:200px;text-align:center;" for="txt_statu"><button onclick="gbjg1($(this))" value="-1">-</button><label id="suhliangzhen">'+data.Num[key]+'</label><button onclick="gbjg1($(this))" value="1">+</button></label></td><td><label id="jiage">'+(val.pprice*val.pdiscount*data.Num[key]).toFixed(2)+'</label></div></td></tr>';}
                     
                  });
           	 sc+="</table>";
           	$('#cartbody1').html(sc);

		},error:function(){
			//alert(JSON.stringify(sid));
			ajaxCartHotel(pid,0);
		}
   		});	
   }
   function gbjg1($button){
		$tr=$button.parent().parent().parent();
		$pid=$tr.find("td input[type='hidden']").val();
		$psb=$button.val();
		$.ajax({
           url:'ajaxPlusSub1',
           type:'post',
           dataType:'json',  
           data:{'pid':$pid,'psb':$psb},    
           success:function(data){
             sc='<table><tr><th>房间名称</th><th>图片</th><th style="text-align:center;">数量</th><th style="width:50px;">价格</th></tr>';
           	 $.each(data.data,function(key,val){
			           	 	//alert(JSON.stringify(data.Num[key]));
                     if (data.Num[key]>0) {
                       sc+='<tr><td><input type="hidden" value="'+val.pid+'"><label for="txt_statu" style="width:200px;">'+val.pname+'门票</label></td><td><img height="50px" weight="50px" title=" " alt=" " src="__STATIC__/images/'+val.pimg+'" /></td><td><label id="shuliang" style="width:200px;text-align:center;" for="txt_statu"><button onclick="gbjg1($(this))" value="-1">-</button><label id="suhliangzhen">'+data.Num[key]+'</label><button onclick="gbjg1($(this))" value="1">+</button></label></td><td><label id="jiage">'+(val.pprice*val.pdiscount*data.Num[key]).toFixed(2)+'</label></div></td></tr>';}
                     
                  });
           	 sc+="</table>";
           	$('#cartbody1').html(sc);
      		 }
           	});
    }

    function subOrder(){
    	var totalRow = 0;
    	var isStudents = new Array();//学生1成人2
    	$('#cartbody table tr').each(function() {	
    		$(this).find('td:eq(4)').each(function(){	
    			isStudents.push($(this).find("input[type='radio']:checked").val()); 
    		});	
    	});
    	$('#cartbody table tr').each(function() {	
    		$(this).find('td:eq(3)').each(function(){	
    			totalRow += parseFloat($(this).text()); 
    		});	
    	});
    	$('#cartbody1 table tr').each(function() {	
    		$(this).find('td:eq(3)').each(function(){	
    			totalRow += parseFloat($(this).text()); 
    		});	
    	});
    	//alert(isStudents);
		$.ajax({
           url:'payment',
           type:'get',
           tradional:'true',
           dataType:'json',  
           data:{'totalRow':totalRow,'isStudents':isStudents},    
           success:function(data){
           		alert(data.msg);
           		if (data.msg=='请先登录系统') {
           			window.location.href = "login";
           		}
           		if (data.msg=='账户余额不足，请先充值!') {
           			window.location.href = "usersingle";
           		}
           		if (data.code==1) {
           			$('#cartbody').html(" ");
           			$('#cartbody1').html(" ");
           			window.location.href = "order";
           		}
      		}
           	});
    }
</script>
<!-- start-smoth-scrolling -->
</head>
	
<body>
<!-- header -->
<div class="agileits_header">
	<div class="w3l_offers">
		<a href="index">旅游系统</a>
	</div>
	<div class="w3l_search">
		<form action="searchlist" method="post">
			<input type="text" name="Product" value="" placeholder="输入需要查找的关键字">
			<input type="submit" value=" ">
		</form>
	</div>
	<div class="product_list_header">
		<div style="cursor: pointer;"><a onclick="shoppingcart()">
			<span class="glyphicon glyphicon-shopping-cart my-cart-icon">购物车</span></a>
		</div>
	</div>
	<div class="w3l_header_right">
		<ul>
			<li class="dropdown profile_details_drop">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown"><font color="white" th:text="${session.uname}">
					未登录</font><i class="fa fa-user" aria-hidden="true"></i><span class="caret"></span></a>
				<div class="mega-dropdown-menu">
					<div class="w3ls_vegetables">
						<ul class="dropdown-menu drp-mnu">
							<li><a href="login">Login</a></li>
							<li><a href="login">Sign Up</a></li>
						</ul>
					</div>
				</div>
				<!--{else /}{$Think.session.uname} <i class="fa fa-user" aria-hidden="true"></i><span class="caret"></span></a>
				<div class="mega-dropdown-menu">
					<div class="w3ls_vegetables">
						<ul class="dropdown-menu drp-mnu">
							<li><a href="usersingle">个人主页</a></li>
							<li><a href="logout">log out</a></li>
						</ul>
					</div>
				</div>	{/empty}-->
				</font>
			</li>
		</ul>
	</div>
	<div class="w3l_header_right1">
		<h2><a href="mail">Contact Us</a></h2>
	</div>
	<div class="clearfix"> </div>
</div>
<!-- script-for sticky-nav -->
	<script>
	$(document).ready(function() {
		 var navoffeset=$(".agileits_header").offset().top;
		 $(window).scroll(function(){
			var scrollpos=$(window).scrollTop(); 
			if(scrollpos >=navoffeset){
				$(".agileits_header").addClass("fixed");
			}else{
				$(".agileits_header").removeClass("fixed");
			}
		 });
		 
	});
	</script>
<!-- //script-for sticky-nav -->

<!-- Bootstrap Core JavaScript -->
<script src="/static/js/bootstrap.min.js"></script>
<script>
$(document).ready(function(){
    $(".dropdown").hover(            
        function() {
            $('.dropdown-menu', this).stop( true, true ).slideDown("fast");
            $(this).toggleClass('open');        
        },
        function() {
            $('.dropdown-menu', this).stop( true, true ).slideUp("fast");
            $(this).toggleClass('open');       
        }
    );
});
</script>
<!-- here stars scrolling icon -->
	<script type="text/javascript">
		$(document).ready(function() {
			/*
				var defaults = {
				containerID: 'toTop', // fading element id
				containerHoverID: 'toTopHover', // fading element hover id
				scrollSpeed: 1200,
				easingType: 'linear' 
				};
			*/
								
			$().UItoTop({ easingType: 'easeOutQuart' });
								
			});
	</script>
<!-- //here ends scrolling icon -->
<div class="modal fade" id="shopping" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">购物车</h4>
                </div>
                <div class="modal-body" id="cartbody">                 
                    
                </div>
                <div class="modal-body" id="cartbody1">                 
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>
                    <button type="button" id="add_submit"  onclick="subOrder()" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>结算</button>
                </div>
            </div>
        </div>
    </div>
<div class="logo_products">
	<div class="container">
		<div class="w3ls_logo_products_left">
			<h1><a href="index"><span>lvyou</span> 旅游</a></h1>
		</div>
		<div class="w3ls_logo_products_left1">
			<ul class="special_items">
				<li><a href="index">首页</a><i>/</i></li>
				<li><a href="scenic">景点</a><i>/</i></li>
				<li><a href="hotel">酒店</a><i>/</i></li>
				<li><a href="order">订单</a></li>
			</ul>
		</div>
		<div class="w3ls_logo_products_left1">
			<ul class="phone_email">
				<li><i class="fa fa-phone" aria-hidden="true"></i>(0575)88345555</li>
				<li><i class="fa fa-envelope-o" aria-hidden="true"></i><a href="mailto:usx16147220@163.com">usx16147220@163.com</a></li>
			</ul>
		</div>
		<div class="clearfix"> </div>
	</div>
</div>
</body>
</html>