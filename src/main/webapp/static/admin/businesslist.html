<!doctype html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml"><head>
    <meta charset="utf-8">
    <title th:text="${ii}">管理员首页</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="stylesheet" type="text/css" href="/static/js/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="/static/js/font-awesome/css/font-awesome.css">

    <script src="/static/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="/static/js/cookie.js" type="text/javascript"></script>
    <script src="/static/js/jQuery-Knob/js/jquery.knob.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function() {
            $(".knob").knob();
        });
    </script>


    <link rel="stylesheet" type="text/css" href="/static/css/theme.css">
    <link rel="stylesheet" type="text/css" href="/static/css/premium.css">
    <script src="/static/layer/layer.js" type="text/javascript"></script>

</head>
<body class=" theme-blue">
<!-- Demo page code -->

<script type="text/javascript">
    $(function() {
        var match = document.cookie.match(new RegExp('color=([^;]+)'));
        if(match) var color = match[1];
        if(color) {
            $('body').removeClass(function (index, css) {
                return (css.match (/\btheme-\S+/g) || []).join(' ')
            })
            $('body').addClass('theme-' + color);
        }

        $('[data-popover="true"]').popover({html: true});

    });
</script>
<style type="text/css">
    #line-chart {
        height:300px;
        width:800px;
        margin: 0px auto;
        margin-top: 1em;
    }
    .navbar-default .navbar-brand, .navbar-default .navbar-brand:hover {
        color: #fff;
    }
</style>

<script type="text/javascript">
    $(function() {
        var uls = $('.sidebar-nav > ul > *').clone();
        uls.addClass('visible-xs');
        $('#main-menu').append(uls.clone());
    });
</script>


<div class="navbar navbar-default" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="" href="index"><span class="navbar-brand"><span class="fa fa-paper-plane"></span> 管理员首页</span></a></div>

    <div class="navbar-collapse collapse" style="height: 1px;">
        <ul id="main-menu" class="nav navbar-nav navbar-right">
            <li class="dropdown hidden-xs">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    <span class="glyphicon glyphicon-user padding-right-small" style="position:relative;top: 3px;"></span> Admin
                    <i class="fa fa-caret-down"></i>
                </a>

                <ul class="dropdown-menu">
                    <li><a href="./">My Account</a></li>
                    <li class="divider"></li>
                    <li class="dropdown-header">Admin Panel</li>
                    <li><a href="./">Users</a></li>
                    <li><a href="./">Security</a></li>
                    <li><a tabindex="-1" id="logout">Logout</a></li>
                </ul>
            </li>
        </ul>

    </div>
</div>
</div>
<!-- 底部加载外部文件 -->
<div class="sidebar-nav" id="navigation"></div>


<link>
<div class="content" id="content1">

    <script type="text/javascript">
        $(function() {
            var match = document.cookie.match(new RegExp('color=([^;]+)'));
            if(match) var color = match[1];
            if(color) {
                $('body').removeClass(function (index, css) {
                    return (css.match (/\btheme-\S+/g) || []).join(' ')
                })
                $('body').addClass('theme-' + color);
            }

            $('[data-popover="true"]').popover({html: true});

        });
        function delcfm(bid) {
            $('#url').val(bid);//给会话中的隐藏属性URL赋值
            $('#delcfmModel').modal();
        }
        function urlSubmit(){
            var bid=$.trim($("#url").val());//获取会话中的隐藏属性URL

            $.ajax({
                url:"deleteBusiness/"+bid,
                type:"delete",
                dataType:"json",
                success:function(data) {
                      //status:1为成功,0为失败
                    alert(data.msg);
                    goPaging(1);
                }
            });
        }
    </script>
    <style type="text/css">
        #line-chart {
            height:300px;
            width:800px;
            margin: 0px auto;
            margin-top: 1em;
        }
        .navbar-default .navbar-brand, .navbar-default .navbar-brand:hover {
            color: #fff;
        }
    </style>
    <script type="text/javascript">
        $(function() {
            var uls = $('.sidebar-nav > ul > *').clone();
            uls.addClass('visible-xs');
            $('#main-menu').append(uls.clone());
        });
    </script>
    <div class="header">
        <h1 class="page-title">商家列表</h1>
        <ul class="breadcrumb">
            <li><a href="index">首页</a> </li>
            <li class="active">商家列表</li>
        </ul>
    </div>
    <div class="main-content">

        <div class="btn-toolbar list-toolbar">
            <button class="btn btn-primary" onclick="layer.open({
  type: 2,
  skin: '', //加上边框
  title:'新增商家',
  area: ['500px', '570px'], //宽高
  content: 'addbusiness'
});"><a ><i class="fa fa-plus"></i> 新增商家</a></button>
            <div class="btn-group">
            </div>
        </div>
        <!-- 信息删除确认 -->
        <div class="modal fade" id="delcfmModel">
            <div class="modal-dialog">
                <div class="modal-content message_align">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                        <h4 class="modal-title">提示信息</h4>
                    </div>
                    <div class="modal-body">
                        <p>您确认要删除吗。</p>
                    </div>
                    <div class="modal-footer">
                        <input type="hidden" id="url"/>
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <a onclick="urlSubmit()" class="btn btn-success" data-dismiss="modal">确定</a>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <table class="table" id="userlist">

        </table>
        <div class="row">
            <div id="result">

            </div>
        </div>
    </div>
    <footer>
        <hr>
        <p>© 2018 旅游系统</a></p>
    </footer>
</div>
</div>
<script src="/static/js/bootstrap/js/bootstrap.js"></script>
<script type="text/javascript">
    $("[rel=tooltip]").tooltip();
    $(function() {
        $('.demo-cancel-click').click(function(){return false;});
    });
</script>
<script type="text/javascript">
    $("#logout").click(function () {
        $.ajax({
            url:"/admin/logout",
            type:"post",
            data:{"token":"1_"+getCookie("1")},
            dataType:"json",
            success:function (result) {
                if (result.status==1){
                    alert(result.msg);
                    window.location.href="login";
                }else {
                    alert(result.msg);
                    window.location.href="login";
                }
            }
        });
    });
</script>
<script>
    $(function(){
        $('#navigation').load('/static/admin/navigation.html');
        $.ajax({
            url:"businessPaging/"+"1",
            type:"get",
            dataType:"json",
            success:function(data){
                tr='<thead><tr><th>商家id</th><th>商家名</th><th>商家图片</th></th><th>密码</th><th>地址</th><th>联系方式</th><th style="width: 3.5em;"></th></tr></thead>';
                // alert(JSON.stringify(data.list.data[0].uid));
                // alert(data.list.data[0].uid);
                $.each(data.data.data,function(key,val){
                    tr+= '<tbody><tr><td>'+val.bid+'</td><td><a onClick="openChoice('+val.bid+')"> '+val.bname+'</a></td><td><img height="60px" width="100px" src="/static/images/'+val.bimg+'"></td><td>'+val.bpassword+'</td><td>'+val.baddress+'</td><td>'+val.bemail+'</td><td><a class="btn btn-primary" onClick="openUpdate('+val.bid+')"> 修改</a><a class="btn btn-primary" onClick="delcfm('+val.bid+')">删除</a></td></tr></tbody>';
                });
                var pages= data.data.pages;
                var paging='<li class="page-item"><a onclick="goPaging('+1+')" class="page-link" aria-label="Previous"><span aria-hidden="true">«</span></a></li>';
                for (var i = 1; i <=pages ; i++) {
                    if (data.status==i){
                        paging+='<li    class="page-item active"><a class="page-link">'+i+'</a></li>';}
                    else{ paging+='<li onclick="goPaging('+i+')" class="page-item"><a class="page-link">'+i+'</a></li>';}
                }
                paging+='<li class="page-item"><a onclick="goPaging('+pages+')" class="page-link" aria-label="Next"><span aria-hidden="true">»</span></a></li>';
                //  alert(tr);
                $('#userlist').html(tr);
                $("#result").html('<div class="demo" style="min-height: 300px;">\n' +
                    '            <div class="container">\n' +
                    '                <div class="row pad-15">\n' +
                    '                    <div class="col-md-12">\n' +
                    '                        <nav class="pagination-outer" aria-label="Page navigation">\n' +
                    '                            <ul class="pagination">\n' +
                    paging+
                    '                            </ul>\n' +
                    '                        </nav>\n' +
                    '                    </div>\n' +
                    '                </div>\n' +
                    '            </div>\n' +
                    '        </div>');
            }
        });
    });
</script>
<script>
    function goPaging(pageNum) {
        $.ajax({
            url:"businessPaging/"+pageNum.toString(),
            type:"get",
            dataType:"json",
            success:function(data){
                tr='<thead><tr><th>商家id</th><th>商家名</th><th>商家图片</th></th><th>密码</th><th>地址</th><th>联系方式</th><th style="width: 3.5em;"></th></tr></thead>';
                // alert(JSON.stringify(data.list.data[0].uid));
                // alert(data.list.data[0].uid);
                $.each(data.data.data,function(key,val){
                    tr+= '<tbody><tr><td>'+val.bid+'</td><td><a onClick="openChoice('+val.bid+')"> '+val.bname+'</a></td><td><img height="60px" width="100px" src="/static/images/'+val.bimg+'"></td><td>'+val.bpassword+'</td><td>'+val.baddress+'</td><td>'+val.bemail+'</td><td><a class="btn btn-primary" onClick="openUpdate('+val.bid+')"> 修改</a><a class="btn btn-primary" onClick="delcfm('+val.bid+')">删除</a></td></tr></tbody>';
                });
                var pages= data.data.pages;/**/
                var paging='<li class="page-item" onclick="goPaging('+1+')"><a  class="page-link" aria-label="Previous"><span aria-hidden="true">«</span></a></li>';
                for (var i = 1; i <=pages ; i++) {
                    if (data.status==i){
                        paging+='<li class="page-item active"><a class="page-link" >'+i+'</a></li>';}
                    else{ paging+='<li onclick="goPaging('+i+')" class="page-item"><a class="page-link" >'+i+'</a></li>';}
                }/*onclick="'+goPaging(pages)+'"*/
                paging+='<li class="page-item" onclick="goPaging('+pages+')"><a  class="page-link" aria-label="Next"><span aria-hidden="true">»</span></a></li>';
                //  alert(tr);
                $('#userlist').html(tr);
                $("#result").html('<div class="demo" style="min-height: 300px;">\n' +
                    '            <div class="container">\n' +
                    '                <div class="row pad-15">\n' +
                    '                    <div class="col-md-12">\n' +
                    '                        <nav class="pagination-outer" aria-label="Page navigation">\n' +
                    '                            <ul class="pagination">\n' +
                    paging+
                    '                            </ul>\n' +
                    '                        </nav>\n' +
                    '                    </div>\n' +
                    '                </div>\n' +
                    '            </div>\n' +
                    '        </div>');
            }
        });

    }
</script>
<script type="text/javascript">
    function openUpdate(bid){
        layer.open({
            type: 2,
            skin: '', //加上边框
            title:'更新商家信息',
            area: ['450px', '550px'], //宽高
            content: 'openBusiness/'+bid
        });
    }
    function openChoice(bid){
        layer.open({
            type: 2,
            skin: '', //加上边框
            title:'商家状态',
            area: ['450px', '400px'], //宽高
            content: 'openChoice/'+bid
        });
    }
</script>
</body></html>
